var $btnOpenLogin=document.getElementsByClassName("js-btn-open-login"),$btnCloseLogin=document.getElementsByClassName("js-btn-close-login"),$loginFormHolder=document.getElementsByClassName("js-login-form-holder")[0],$errors=document.getElementsByClassName("js-errors")[0],$formLogin=document.getElementById("login-form"),iDates=!1;document.getElementsByName("login_ident")[0]&&(iDates=!0);for(var i=0;i<$btnOpenLogin.length;i++)$btnOpenLogin[i].addEventListener("click",function(e){e.preventDefault();$loginFormHolder.classList.remove("hidden")},!1);for(i=0;i<$btnCloseLogin.length;i++)$btnCloseLogin[i].addEventListener("click",function(e){e.preventDefault();$loginFormHolder.classList.add("hidden")},!1);function loginFormAddRequiredError(e,t){var n=document.createElement("span"),o=e.parentNode.getElementsByClassName("required");0<o.length&&e.parentNode.removeChild(o[0]),$errors.innerHTML='',n.className="required",n.innerHTML=t,e.parentNode.appendChild(n),e.classList.add("error")}function submitHttpRequest(e,t,n){var o=new XMLHttpRequest,r=document.getElementById("login_submit"),t=(iDates?"ident":"username")+"="+encodeURIComponent(e)+"&password="+encodeURIComponent(t)+"&trk="+n;iDates?window.location=$formLogin.getAttribute("action")+"/login?"+t:((n=document.createElement("div")).appendChild(document.createElement("span")),n.className="lds-ripple",document.getElementsByTagName('body')[0].appendChild(n),r.setAttribute("disabled","disabled"),o.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var e=JSON.parse(this.responseText),t=e.errors,n=document.getElementsByClassName('lds-ripple');if(0<n.length&&document.getElementsByTagName('body')[0].removeChild(n[0]),r.removeAttribute("disabled"),0==e.success){if(0<t.length){var t=t[0],o="data-login-fail-message";switch(t){case"Username parameter cannot be empty.":o="data-username-fail-message";break;case"Password parameter cannot be empty.":o="data-password-fail-message"}t=r.hasAttribute(o)?r.getAttribute(o):t;$errors.innerHTML='<span class="required">'+t+"</span>"}}else window.location=e.url}},o.open("POST","/user/login",!0),o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),o.send(t))}$formLogin&&($formLogin.onsubmit=function(){var e=document.getElementsByName(iDates?"login_ident":"login_username")[0];void 0===e&&(e=document.getElementsByName("username")[0]);var t=e.value,n=document.getElementsByName("login_password")[0];void 0===n&&(n=document.getElementsByName("password")[0]);var o=n.value,r=document.getElementsByName("trk")[0].value,a=!1,s=e.parentNode.getElementsByClassName("required");0<s.length&&e.parentNode.removeChild(s[0])&&e.classList.remove("error"),""==t?null!=(s=e.getAttribute("data-username-required-message"))&&""!=s&&(loginFormAddRequiredError(e,s),a=!0):null==(i=e.getAttribute("data-email-invalid-message"))||""==i||/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,10})+$/.test(t)||(loginFormAddRequiredError(e,i),a=!0);var i=n.parentNode.getElementsByClassName("required");return 0<i.length&&n.parentNode.removeChild(i[0])&&n.classList.remove("error"),""!=o||null!=(i=n.getAttribute("data-password-required-message"))&&""!=i&&(loginFormAddRequiredError(n,i),a=!0),0==a&&submitHttpRequest(t,o,r),!1});